{% extends 'base.html' %}
{% block title %} Books {% endblock %}

{% block content %}
<h1 class="text-center">Books</h1>

<form method="POST" role="form" action="/books">
  <div class="d-flex justify-content-center list">
    {% if recs_to_user %}
      <button type="submit" name="recommended" value="to user" class="btn btn-primary text-wrap me-1 lh-1 active"><small>recommended to me</small></button>
      <button type="submit" name="recommended" value="by user" class="btn btn-primary text-wrap ms-1 lh-1"><small>recommended by me</small></button>
      {% set word = 'by' %}
    {% else %}
      <button type="submit" name="recommended" value="to user" class="btn btn-primary text-wrap me-1 lh-1"><small>recommended to me</small></button>
      <button type="submit" name="recommended" value="by user" class="btn btn-primary text-wrap ms-1 lh-1 active"><small>recommended by me</small></button>
      {% set word = 'to' %}
    {% endif %}
  </div>
</form>

{% for message in get_flashed_messages(with_categories=True) %}
  <div class="alert alert-{{ message[0] }} mt-1" role="alert">
    {{ message[1] }}
  </div>
{% endfor %}

<div class="d-flex flex-column mt-3">
  {% for book in books %}
  <div class="card w-100 mb-2">
    <div class="card-body">
      <h5 class="card-title">{{book['volumeInfo']['title']}}</h5>
      <h6 class="card-subtitle mb-2 text-muted nospace"><nobr><span>by&nbsp;</span>

        {% set authors = book['volumeInfo']['authors'] %}
        <span>{{authors[0]}}</span>
        {% if authors|length > 2 %}
          {% for author in authors[1:] %}
            <span>, {{author}}</span>
          {% endfor %}
        {% endif %}
      </nobr></h6>
      
      <div class="d-flex text-muted">
        <i class="fa-solid fa-wand-magic-sparkles"></i>&nbsp;
        <small><p class="m-0 lh-1">{{word}} {{book['fname']}} {{book['lname']}} on {{book['date'].strftime("%d-%b-%y")}}</p></small>
      </div>

    </div>
  </div>
  {% endfor %}
</div>

{% endblock %}